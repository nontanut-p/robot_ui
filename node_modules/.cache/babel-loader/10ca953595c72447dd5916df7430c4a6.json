{"ast":null,"code":"var _jsxFileName = \"/home/pat/robot_ui/src/App.js\",\n    _s = $RefreshSig$();\n\nimport { BrowserRouter as Router, Switch, Route, Link } from 'react-router-dom';\nimport Navbar from './components/layouts/Navbar';\nimport Home from './components/pages/Home';\nimport Socket from './components/pages/Socket';\nimport Header from './components/components/Header';\nimport Maps from './components/components/Maps';\nimport Footer from './components/components/Footer';\nimport { useState, useEffect } from 'react';\nimport io from \"socket.io-client\";\nimport wrtc from 'wrtc';\nimport socket from 'socket.io';\nimport SimplePeer from 'simple-peer';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  useEffect(function () {\n    var robot = {\n      pcConfig: {\n        'iceServers': [{\n          'urls': 'stun:stun.l.google.com:19302'\n        }]\n      },\n      socket_id: null,\n      candidates: [],\n      peer: null,\n      auth_type: null,\n      b_connected: false,\n      timer_check_ready: null,\n      connect: function connect(socket_id) {\n        console.log('connect robot');\n\n        if (this.socket_id) {\n          console.warn('robot already exists');\n          return;\n        }\n\n        this.candidates = [];\n        this.socket_id = socket_id;\n        socket.emit('message', {\n          to: socket_id,\n          message: {\n            type: 'call'\n          }\n        });\n      },\n      disconnect: function disconnect() {\n        console.log('disconnect robot');\n        if (this.peer) this.send_peer({\n          event: 'bye'\n        });\n        this.destroy();\n      },\n      destroy: function destroy() {\n        var _this = this;\n\n        if (this.socket_id) {\n          this.socket_id = null;\n          setTimeout(function () {\n            if (_this.peer) {\n              _this.peer.destroy();\n\n              _this.peer = null;\n            }\n          }, 100);\n\n          if (this.timer_check_ready) {\n            clearInterval(this.timer_check_ready);\n            this.timer_check_ready = null;\n          }\n        }\n      },\n      send_peer: function send_peer(data) {\n        console.log('send_peer', data);\n        this.peer.send(JSON.stringify(data));\n      },\n      createPeerConnection: function createPeerConnection(socket_id, auth_type, msg) {\n        if (!this.socket_id) {\n          console.error('robot not connect');\n          return;\n        }\n\n        var th = this;\n        /*    if( pcConfig.iceServers.length<=1 ){\n        \t  console.log('wait ice servers');\n        \t  setTimeout( ()=>{ th.createPeerConnection(socket_id, auth_type, msg); }, 200);\n        \t  return;\n        \t}*/\n\n        console.log('createPeerConnection');\n        th.socket_id = socket_id;\n        th.auth_type = auth_type;\n        var peer = this.peer = new SimplePeer({\n          initiator: false,\n          config: this.pcConfig\n        });\n        peer.on('error', function (err) {\n          console.error(err);\n        });\n        peer.on('connect', function () {\n          console.log('peer connected');\n          th.b_connected = true;\n\n          if (!th.timer_check_ready) {\n            th.timer_check_ready = setInterval(function () {\n              th.send_peer({\n                event: 'ready'\n              });\n            }, 1000);\n          }\n        });\n        peer.on('patTest', function () {\n          console.log('patTest p2p');\n        });\n        peer.on('close', function () {\n          console.log('peer closed');\n          th.b_connected = false;\n          th.destroy();\n        });\n        peer.on('signal', function (data) {\n          console.log('signal : ' + JSON.stringify(data));\n          th.sendMessage(data);\n        });\n        peer.on('data', function (data) {\n          console.log('got data : ', data);\n\n          try {\n            data = JSON.parse(data);\n          } catch (e) {\n            console.warn('cannot parse data');\n            return;\n          }\n\n          console.log('data : ' + JSON.stringify(data));\n\n          if (data.event == 'ready') {\n            console.log('robot ready');\n\n            if (th.timer_check_ready) {\n              clearInterval(th.timer_check_ready);\n              th.timer_check_ready = null;\n            } // th.send_peer({event:'get_path_list'});\n\n\n            setInterval(function () {\n              return th.send_peer({\n                event: 'get_pc_status'\n              });\n            }, 5000);\n          } else if (data.event == 'get_path_list') {\n            console.log('got path list');\n\n            if (data.err) {\n              console.error(data.err);\n            } else {\n              if (data.paths.length > 0) {\n                console.log('data.path', data.paths);\n                th.send_peer({\n                  event: 'get_path',\n                  name: data.paths[0]\n                });\n              }\n            }\n          } else if (data.event == 'get_path') {\n            console.log('got path');\n\n            if (data.err) {\n              console.error(data.err);\n            }\n          }\n        });\n        this.candidates.forEach(function (c) {\n          peer.signal(c);\n        });\n        peer.signal(msg);\n      },\n      sendMessage: function sendMessage(message) {\n        var msg = {\n          to: this.socket_id,\n          message: message\n        };\n\n        try {\n          console.log('send message : ' + JSON.stringify(msg));\n        } catch (e) {\n          console.log('send message : [Circular]');\n        }\n\n        socket.emit('message', msg);\n      },\n      add_candidtates: function add_candidtates(message) {\n        console.log('got candidate');\n\n        if (this.socket_id) {\n          if (!this.peer) this.candidates.push(message);else this.peer.signal(message);\n        } else {\n          console.error('no robot');\n        }\n      }\n    };\n    var URL = 'https://weather.mtec.or.th'; //const URL = 'http://localhost:8080';\n\n    var email = 'pat',\n        pass = 'agrimtec';\n    var socket = null;\n    new Promise(function (resolve, reject) {\n      //resolve(console.log('print'))\n      socket = io.connect(URL); //console.log('Im here')\n\n      socket.on('connect', function () {\n        console.log('socket connected');\n      }); // need log in\n\n      socket.on('request_login', function () {\n        //console.log('request_login');\n        socket.emit('login', {\n          email: email,\n          pass: pass\n        });\n      }); // login succeeded\n\n      socket.on('auth', function (data) {\n        //console.log('auth ok');\n        // get list of the robots that are currently online\n        socket.emit('get_robot_list');\n      });\n      socket.on('unauth', function (data) {\n        console.warn('cannot log in');\n      }); // got robot list\n\n      socket.on('get_robot_list', function (robots) {\n        if (!robots.peer) {\n          console.log('undefine robot not peer');\n          console.log('socket ID', socket.id);\n          console.log(robots[0]);\n          console.log('robot socket name', robots[0].socket_id);\n        } // connect to the first robot if exists\n\n\n        if (robots.length > 0 && !robot.peer) {\n          robot.connect(robots[0].socket_id);\n        }\n      }); // got message from server\n\n      socket.on('message', function (msg) {\n        var sender_id = msg.from; //console.log('sender_id', sender_id, 'msg auth type', msg.auth_type , 'message', msg.message)\n        //console.log('message : '+JSON.stringify(msg));\n\n        var message = msg.message;\n\n        if (message.type === 'offer') {\n          console.log('got offer');\n          robot.createPeerConnection(sender_id, msg.auth_type, message);\n        } else if (message.candidate) {\n          robot.add_candidtates(message);\n        } else {\n          console.warn('unknown message');\n        }\n      }); // receive when robot went offline\n\n      socket.on('robot_leave', function (socket_id) {\n        console.log('robot_leave : ' + socket_id);\n\n        if (robot.socket_id == socket_id) {\n          robot.destroy();\n        } else {\n          console.error('robot_leave : socket_id not match : ' + robot.socket_id + ' / ' + socket_id);\n        }\n      }); // receive when the robot refused the connection\n\n      socket.on('reject_call', function (msg) {\n        console.warn('reject_call');\n      }); // got error message\n\n      socket.on('alert', function (msg) {\n        console.warn('alert : ' + msg);\n        alert(msg);\n      });\n    });\n  }, 0);\n  return /*#__PURE__*/_jsxDEV(Router, {\n    children: /*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/\",\n        children: [' ', /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(Navbar, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 7\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 283,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Home, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/map\",\n        children: /*#__PURE__*/_jsxDEV(Maps, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 291,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/test\",\n        children: /*#__PURE__*/_jsxDEV(Socket, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 278,\n    columnNumber: 3\n  }, this);\n}\n\n_s(App, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/home/pat/robot_ui/src/App.js"],"names":["BrowserRouter","Router","Switch","Route","Link","Navbar","Home","Socket","Header","Maps","Footer","useState","useEffect","io","wrtc","socket","SimplePeer","App","robot","pcConfig","socket_id","candidates","peer","auth_type","b_connected","timer_check_ready","connect","console","log","warn","emit","to","message","type","disconnect","send_peer","event","destroy","setTimeout","clearInterval","data","send","JSON","stringify","createPeerConnection","msg","error","th","initiator","config","on","err","setInterval","sendMessage","parse","e","paths","length","name","forEach","c","signal","add_candidtates","push","URL","email","pass","Promise","resolve","reject","robots","id","sender_id","from","candidate","alert"],"mappings":"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","sourcesContent":["import { BrowserRouter as Router, Switch, Route, Link } from 'react-router-dom';\nimport Navbar from './components/layouts/Navbar';\nimport Home from './components/pages/Home';\nimport Socket from './components/pages/Socket';\nimport Header from './components/components/Header';\nimport Maps from './components/components/Maps';\nimport Footer from './components/components/Footer'\nimport { useState, useEffect } from 'react'\nimport io from \"socket.io-client\";\nimport wrtc from 'wrtc'\nimport socket from 'socket.io'\nimport SimplePeer from 'simple-peer'\n\nfunction App() {\n\n\tuseEffect(() => {\n\t\tvar robot = {\n\t\t\tpcConfig: {\n\t\t\t\t'iceServers': [{\n\t\t\t\t\t'urls': 'stun:stun.l.google.com:19302'\n\t\t\t\t},\n\t\t\t\t]\n\t\t\t},\n\n\t\t\tsocket_id: null,\n\t\t\tcandidates: [],\n\t\t\tpeer: null,\n\t\t\tauth_type: null,\n\t\t\tb_connected: false,\n\t\t\ttimer_check_ready: null,\n\n\t\t\tconnect: function (socket_id) {\n\t\t\t\tconsole.log('connect robot');\n\t\t\t\tif (this.socket_id) {\n\t\t\t\t\tconsole.warn('robot already exists');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.candidates = [];\n\t\t\t\tthis.socket_id = socket_id;\n\t\t\t\tsocket.emit('message', {\n\t\t\t\t\tto: socket_id,\n\t\t\t\t\tmessage: {\n\t\t\t\t\t\ttype: 'call'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tdisconnect: function () {\n\t\t\t\tconsole.log('disconnect robot');\n\t\t\t\tif (this.peer)\n\t\t\t\t\tthis.send_peer({ event: 'bye' });\n\t\t\t\tthis.destroy();\n\t\t\t},\n\n\t\t\tdestroy: function () {\n\t\t\t\tif (this.socket_id) {\n\t\t\t\t\tthis.socket_id = null;\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tif (this.peer) {\n\t\t\t\t\t\t\tthis.peer.destroy();\n\t\t\t\t\t\t\tthis.peer = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 100);\n\t\t\t\t\tif (this.timer_check_ready) {\n\t\t\t\t\t\tclearInterval(this.timer_check_ready);\n\t\t\t\t\t\tthis.timer_check_ready = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tsend_peer: function (data) {\n\t\t\t\tconsole.log('send_peer', data);\n\t\t\t\tthis.peer.send(JSON.stringify(data));\n\t\t\t},\n\n\t\t\tcreatePeerConnection: function (socket_id, auth_type, msg) {\n\t\t\t\tif (!this.socket_id) {\n\t\t\t\t\tconsole.error('robot not connect');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar th = this;\n\t\t\t\t/*    if( pcConfig.iceServers.length<=1 ){\n\t\t\t\t\t  console.log('wait ice servers');\n\t\t\t\t\t  setTimeout( ()=>{ th.createPeerConnection(socket_id, auth_type, msg); }, 200);\n\t\t\t\t\t  return;\n\t\t\t\t\t}*/\n\t\t\t\tconsole.log('createPeerConnection');\n\t\t\t\tth.socket_id = socket_id;\n\t\t\t\tth.auth_type = auth_type;\n\t\t\t\tvar peer = this.peer = new SimplePeer({ initiator: false, config: this.pcConfig });\n\t\t\t\tpeer.on('error', (err) => {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t});\n\t\t\t\tpeer.on('connect', () => {\n\t\t\t\t\tconsole.log('peer connected');\n\t\t\t\t\tth.b_connected = true;\n\t\t\t\t\tif (!th.timer_check_ready) {\n\t\t\t\t\t\tth.timer_check_ready = setInterval(() => {\n\t\t\t\t\t\t\tth.send_peer({ event: 'ready' });\n\t\t\t\t\t\t}, 1000);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tpeer.on('patTest', () => {\n\t\t\t\t\tconsole.log('patTest p2p')\n\t\t\t\t})\n\t\t\t\tpeer.on('close', () => {\n\t\t\t\t\tconsole.log('peer closed');\n\t\t\t\t\tth.b_connected = false;\n\t\t\t\t\tth.destroy();\n\t\t\t\t});\n\t\t\t\tpeer.on('signal', (data) => {\n\t\t\t\t\tconsole.log('signal : ' + JSON.stringify(data));\n\t\t\t\t\tth.sendMessage(data);\n\t\t\t\t});\n\t\t\t\tpeer.on('data', (data) => {\n\t\t\t\t\tconsole.log('got data : ', data);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata = JSON.parse(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\tconsole.warn('cannot parse data');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log('data : ' + JSON.stringify(data));\n\t\t\t\t\tif (data.event == 'ready') {\n\t\t\t\t\t\tconsole.log('robot ready');\n\t\t\t\t\t\tif (th.timer_check_ready) {\n\t\t\t\t\t\t\tclearInterval(th.timer_check_ready);\n\t\t\t\t\t\t\tth.timer_check_ready = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// th.send_peer({event:'get_path_list'});\n\t\t\t\t\t\tsetInterval(() => (th.send_peer({ event: 'get_pc_status' })), 5000)\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.event == 'get_path_list') {\n\t\t\t\t\t\tconsole.log('got path list');\n\t\t\t\t\t\tif (data.err) {\n\t\t\t\t\t\t\tconsole.error(data.err);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif (data.paths.length > 0) {\n\t\t\t\t\t\t\t\tconsole.log('data.path', data.paths)\n\t\t\t\t\t\t\t\tth.send_peer({ event: 'get_path', name: data.paths[0] });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.event == 'get_path') {\n\t\t\t\t\t\tconsole.log('got path');\n\t\t\t\t\t\tif (data.err) {\n\t\t\t\t\t\t\tconsole.error(data.err);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.candidates.forEach((c) => {\n\t\t\t\t\tpeer.signal(c);\n\t\t\t\t});\n\t\t\t\tpeer.signal(msg);\n\t\t\t},\n\n\t\t\tsendMessage: function (message) {\n\t\t\t\tvar msg = { to: this.socket_id, message: message };\n\t\t\t\ttry {\n\t\t\t\t\tconsole.log('send message : ' + JSON.stringify(msg));\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tconsole.log('send message : [Circular]');\n\t\t\t\t}\n\t\t\t\tsocket.emit('message', msg);\n\t\t\t},\n\n\t\t\tadd_candidtates: function (message) {\n\t\t\t\tconsole.log('got candidate');\n\t\t\t\tif (this.socket_id) {\n\t\t\t\t\tif (!this.peer)\n\t\t\t\t\t\tthis.candidates.push(message);\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.peer.signal(message);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.error('no robot');\n\t\t\t\t}\n\t\t\t},\n\n\t\t};\n\t\tconst URL = 'https://weather.mtec.or.th';\n\t\t//const URL = 'http://localhost:8080';\n\t\tconst email = 'pat', pass = 'agrimtec';\n\t\tvar socket = null;\n\t\tnew Promise((resolve, reject) => {\n\t\t\t//resolve(console.log('print'))\n\t\t\tsocket = io.connect(URL);\n\t\t\t//console.log('Im here')\n\t\t\tsocket.on('connect', function () {\n\t\t\t\tconsole.log('socket connected');\n\n\t\t\t});\n\n\t\t\t// need log in\n\t\t\tsocket.on('request_login', () => {\n\t\t\t\t//console.log('request_login');\n\t\t\t\tsocket.emit('login', { email: email, pass: pass });\n\t\t\t});\n\n\t\t\t// login succeeded\n\t\t\tsocket.on('auth', function (data) {\n\t\t\t\t//console.log('auth ok');\n\t\t\t\t// get list of the robots that are currently online\n\t\t\t\tsocket.emit('get_robot_list');\n\t\t\t});\n\n\t\t\tsocket.on('unauth', function (data) {\n\t\t\t\tconsole.warn('cannot log in');\n\t\t\t});\n\n\t\t\t// got robot list\n\t\t\tsocket.on('get_robot_list', function (robots) {\n\t\t\t\tif (!robots.peer) {\n\t\t\t\t\tconsole.log('undefine robot not peer')\n\t\t\t\t\tconsole.log('socket ID', socket.id)\n\t\t\t\t\tconsole.log(robots[0])\n\t\t\t\t\tconsole.log('robot socket name', robots[0].socket_id)\n\t\t\t\t}\n\n\t\t\t\t// connect to the first robot if exists\n\t\t\t\tif (robots.length > 0 && !robot.peer) {\n\t\t\t\t\trobot.connect(robots[0].socket_id);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// got message from server\n\t\t\tsocket.on('message', (msg) => {\n\t\t\t\tvar sender_id = msg.from;\n\t\t\t\t//console.log('sender_id', sender_id, 'msg auth type', msg.auth_type , 'message', msg.message)\n\t\t\t\t//console.log('message : '+JSON.stringify(msg));\n\t\t\t\tvar message = msg.message;\n\n\t\t\t\tif (message.type === 'offer') {\n\t\t\t\t\tconsole.log('got offer');\n\t\t\t\t\trobot.createPeerConnection(sender_id, msg.auth_type, message);\n\t\t\t\t}\n\t\t\t\telse if (message.candidate) {\n\t\t\t\t\trobot.add_candidtates(message);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.warn('unknown message');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// receive when robot went offline\n\t\t\tsocket.on('robot_leave', (socket_id) => {\n\t\t\t\tconsole.log('robot_leave : ' + socket_id);\n\t\t\t\tif (robot.socket_id == socket_id) {\n\t\t\t\t\trobot.destroy();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.error('robot_leave : socket_id not match : ' + robot.socket_id + ' / ' + socket_id);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// receive when the robot refused the connection\n\t\t\tsocket.on('reject_call', (msg) => {\n\t\t\t\tconsole.warn('reject_call');\n\t\t\t});\n\n\t\t\t// got error message\n\t\t\tsocket.on('alert', (msg) => {\n\t\t\t\tconsole.warn('alert : ' + msg);\n\t\t\t\talert(msg);\n\t\t\t});\n\t\t});\n\n\n\t}\n\n\t\t, 0);\n\treturn (\n\n\t\t<Router>\n\n\t\t\t<Switch>\n\t\t\t\t<Route exact path='/'>\n\t\t\t\t\t{' '}\n\t\t\t\t\t<div >\n\t\t\t\t\t\t<Navbar />\n\t\t\t\t\t</div>\n\t\t\t\t\t<Header />\n\t\t\t\t\t<Home />\n\t\t\t\t\t<Footer />\n\t\t\t\t</Route>\n\t\t\t\t<Route exact path='/map'>\n\t\t\t\t\t<Maps />\n\t\t\t\t</Route>\n\t\t\t\t<Route exact path=\"/test\" >\n\t\t\t\t\t<Socket />\n\t\t\t\t</Route>\n\t\t\t</Switch>\n\n\t\t</Router>\n\t);\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}